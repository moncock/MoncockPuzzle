<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MONCOCK PUZZLE</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1 class="title"><span class="emoji">🐔</span>MONCOCK PUZZLE</h1>

    <div class="how-to-play">
      <h2><span class="emoji">📝</span>How to Play Moncock Puzzle</h2>
      <ol>
        <li>Choose a wallet: Injected (MetaMask/Rabby/Backpack/etc.).</li>
        <li>Start Game</li>
        <li>Each round you’ll receive a unique Moncock artwork, created by talented artists such as Laquita Reed, Sanji Vinsmoke, Asura14, and J J.</li>
        <li>Rearrange the scrambled pieces and restore the image before the timer runs out.</li>
        <li>You can mint any time. If you complete the puzzle, your NFT will look better and might receive a higher rank. Even if you can’t finish, you can still mint but completed puzzles give you the best results.</li>
      </ol>
    </div>

    <div class="controls">
      <button id="connectInjectedBtn">🔌 Injected Wallet</button>
      <button id="connectWalletConnectBtn">🔗 WalletConnect</button>
      <span id="walletStatus"></span>
    </div>

    <div class="controls">
      <button id="startBtn" disabled>🎮 Start Game</button>
      <button id="mintBtn" disabled>💎 Mint NFT</button>
      <button id="restartBtn" disabled>🔄 Restart</button>
    </div>

    <div id="mintStatus" style="margin-top:.5rem;font-size:.9rem;color:#4c51bf;"></div>

    <div class="timer">⏲️ Time Left: <span id="timeLeft">30</span>s</div>

    <!-- Two-column layout: LEFT reference, RIGHT puzzle -->
    <div class="game-row">
      <!-- LEFT: permanent reference (never changes) -->
      <div class="preview">
        <h3>Reference Picture</h3>
        <img id="referenceImg" src="preview.png" alt="Puzzle Reference" />
      </div>

      <!-- RIGHT: puzzle grid -->
      <div id="puzzleGrid" class="grid"></div>
    </div>
  </div>

  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- Filtered error logger: only logs errors from our own script.js -->
  <script>
    window.addEventListener('error', function (e) {
      if (!e.filename || !/\/script\.js(\?.*)?$/.test(e.filename)) return;
      console.error('App JS error:', e.message, 'at', e.filename + ':' + e.lineno + ':' + e.colno);
    });
  </script>

  <!-- 👇 Automatic cache-busting for script.js -->
  <script>
    (function () {
      var version = (window.__BUILD_ID__ || Date.now());
      var s = document.createElement('script');
      s.src = 'script.js?v=' + encodeURIComponent(version);
      document.head.appendChild(s);
    })();
  </script>

  <!-- Safety net: ensure the Connect button always works -->
  <script>
    (function() {
      function wireNow() {
        var btn = document.getElementById('connectInjectedBtn');
        if (!btn) return;
        btn.disabled = false;
        var clone = btn.cloneNode(true);
        btn.parentNode.replaceChild(clone, btn);
        clone.addEventListener('click', function(e) {
          e.preventDefault();
          if (typeof window.connectInjected === 'function') {
            window.connectInjected();
          } else {
            console.warn('App not ready yet—trying again soon.');
          }
        });
      }
      document.addEventListener('DOMContentLoaded', wireNow);
      var tries = 0;
      var t = setInterval(function() {
        tries++;
        if (typeof window.connectInjected === 'function') { wireNow(); clearInterval(t); }
        if (tries > 60) clearInterval(t); // ~15s
      }, 250);
    })();
  </script>


  <!-- Hidden so old JS still works -->
<img id="previewImg" alt="" style="display:none" />

</body>
</html>
