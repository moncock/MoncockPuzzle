<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>MONCOCK PUZZLE</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1 class="title"><span class="emoji">ğŸ”</span>MONCOCK PUZZLE</h1>

    <div class="how-to-play">
      <h2><span class="emoji">ğŸ“</span>How to Play Moncock Puzzle</h2>
      <ol>
        <li>Choose a wallet: Injected (MetaMask/Rabby/Backpack/etc.).</li>
        <li>Start Game</li>
        <li>Each round youâ€™ll receive a unique Moncock artwork, created by talented artists such as Laquita Reed, Sanji Vinsmoke, Asura14, and J J.</li>
        <li>Rearrange the scrambled pieces and restore the image before the timer runs out.</li>
        <li>You can mint your NFT at any time â€” even if you donâ€™t complete the puzzle.</li>
        <li>Finish for Higher Rank
Complete the puzzle to boost your NFTâ€™s rank. The faster you solve, the rarer and more valuable your NFT becomes.</li>
      </ol>
    </div>

    <div class="controls">
      <button id="connectInjectedBtn">ğŸ”Œ Injected Wallet</button>
      <button id="connectWalletConnectBtn">ğŸ”— WalletConnect</button>
      <span id="walletStatus"></span>
    </div>
    <div class="controls">
      <button id="startBtn" disabled>ğŸ® Start Game</button>
      <button id="mintBtn" disabled>ğŸ’ Mint NFT</button>
      <button id="restartBtn" disabled>ğŸ”„ Restart</button>
    </div>
    <div id="mintStatus" style="margin-top:.5rem;font-size:.9rem;color:#4c51bf;"></div>

    <div class="timer">â²ï¸ Time Left: <span id="timeLeft">45</span>s</div>

    <div class="game-row">
      <div class="preview">
        <h3>Reference Picture</h3>
        <img id="previewImg" src="preview.png" alt="Puzzle Reference" />
      </div>
      <div id="puzzleGrid" class="grid"></div>
    </div>
  </div>

  <!-- Load libs FIRST so globals exist for script.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <!-- Filtered error logger: only logs errors from our own script.js -->
  <script>
    window.addEventListener('error', function (e) {
      // Only handle errors that originate from our app file (script.js)
      if (!e.filename || !/\/script\.js(\?.*)?$/.test(e.filename)) return;
      // Show a non-blocking console message instead of an alert
      console.error('App JS error:', e.message, 'at', e.filename + ':' + e.lineno + ':' + e.colno);
    });
  </script>

  <!-- Your application logic (cache-busted) -->
  <script src="script.js?v=3" defer></script>

  <!-- Safety net: ensure the Connect button always works -->
  <script>
    (function() {
      function wireNow() {
        var btn = document.getElementById('connectInjectedBtn');
        if (!btn) return;
        btn.disabled = false;
        var clone = btn.cloneNode(true);
        btn.parentNode.replaceChild(clone, btn);
        clone.addEventListener('click', function(e) {
          e.preventDefault();
          if (typeof window.connectInjected === 'function') {
            window.connectInjected();
          } else {
            // gentle message if app not ready yet
            console.warn('App not ready yetâ€”trying again soon.');
          }
        });
      }
      document.addEventListener('DOMContentLoaded', wireNow);
      var tries = 0;
      var t = setInterval(function() {
        tries++;
        if (typeof window.connectInjected === 'function') { wireNow(); clearInterval(t); }
        if (tries > 60) clearInterval(t); // ~15s
      }, 250);
    })();
  </script>
</body>
</html>
